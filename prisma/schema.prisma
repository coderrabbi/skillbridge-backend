generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  STUDENT
  TUTOR
  ADMIN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

model User {
  id       String   @id @default(uuid())
  email    String   @unique
  name     String?
  password String
  role     UserRole @default(STUDENT)
  avatar   String?
  isActive Boolean  @default(true)
  isBanned Boolean  @default(false)

  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  tutorProfile TutorProfile?
  bookings     Booking[]     @relation("UserBookings")
  reviews      Review[]      @relation("UserReviews")

  @@index([isActive])
  @@map("users")
}

model Category {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tutors TutorProfile[]

  @@map("categories")
}

model TutorProfile {
  id         String  @id @default(uuid())
  userId     String  @unique
  bio        String?
  experience Int?
  hourlyRate Float?
  education  String?

  rating       Float @default(0)
  totalReviews Int   @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user           User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  availabilities Availability[]
  category       Category?      @relation(fields: [categoryId], references: [id])
  categoryId     String?
  bookings       Booking[]      @relation("TutorBookings")

  @@map("tutor_Profiles")
}

model Availability {
  id             String       @id @default(uuid())
  tutorProfileId String
  tutorProfile   TutorProfile @relation(fields: [tutorProfileId], references: [id], onDelete: Cascade)

  start    DateTime
  end      DateTime
  isBooked Boolean  @default(false)

  booking Booking?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([tutorProfileId, start, end])
  @@map("availabilities")
}

model Booking {
  id             String @id @default(uuid())
  studentId      String
  tutorId        String
  availabilityId String @unique

  start  DateTime
  end    DateTime
  status BookingStatus @default(CONFIRMED)
  amount Float?

  student      User         @relation("UserBookings", fields: [studentId], references: [id])
  tutor        TutorProfile @relation("TutorBookings", fields: [tutorId], references: [id])
  availability Availability @relation(fields: [availabilityId], references: [id], onDelete: Restrict)

  review Review?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("bookings")
}

model Review {
  id        String  @id @default(uuid())
  bookingId String  @unique
  booking   Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  studentId String
  tutorId   String
  student   User   @relation("UserReviews", fields: [studentId], references: [id])

  rating  Int // 1â€“5
  comment String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tutorId])
  @@map("reviews")
}
